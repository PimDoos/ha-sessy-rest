# Include this file under the `rest:` key in your configuration.yaml
# Example: `rest: !include sessy.yaml`
- resource_template: "http://SESSY_BATTERY_IP/api/v1/power/status"
  username: !secret sessy_battery_username
  password: !secret sessy_battery_password
  scan_interval: 5
  sensor:
    - name: Sessy Status
      value_template: >
        {{ value_json.sessy.system_state | replace('SYSTEM_STATE_','') | replace('_',' ') | title }}

    - name: Sessy Power
      value_template: "{{ value_json.sessy.power | int }}"
      unit_of_measurement: W
      device_class: power
      state_class: measurement

    - name: Sessy Power Setpoint
      value_template: "{{ value_json.sessy.power_setpoint | int }}"
      unit_of_measurement: W
      device_class: power
      state_class: measurement

    - name: Sessy Power Charging
      value_template: "{{ [value_json.sessy.power | int,0] | min *-1}}"
      unit_of_measurement: W
      device_class: power
      state_class: measurement

    - name: Sessy Power Discharging
      value_template: "{{ [value_json.sessy.power | int,0] | max }}"
      unit_of_measurement: W
      device_class: power
      state_class: measurement

    - name: Sessy State of Charge
      value_template: "{{ value_json.sessy.state_of_charge | float | round(3) * 100 }}"
      unit_of_measurement: "%"
      device_class: battery
      state_class: total

    - name: Sessy Battery Energy
      value_template: "{{ value_json.sessy.state_of_charge | float | round(3) * 5 }}"
      unit_of_measurement: "kWh"
      device_class: energy
      state_class: total

    - name: Sessy Battery Energy Inverted
      value_template: "{{ value_json.sessy.state_of_charge | float | round(3) * -5 }}"
      unit_of_measurement: "kWh"
      device_class: energy
      state_class: total

- resource_template: "http://SESSY_BATTERY_IP/api/v1/power/active_strategy"
  username: !secret sessy_battery_username
  password: !secret sessy_battery_password
  scan_interval: 30
  sensor:
    - name: Sessy Power Strategy
      value_template: >
        {{ value_json.strategy | replace('POWER_STRATEGY_','') | replace('_',' ') | title }}

- resource_template: "http://SESSY_DONGLE_IP/api/v1/p1/status"
  username: !secret sessy_dongle_username
  password: !secret sessy_dongle_password
  scan_interval: 5
  sensor:
    - name: Sessy P1 Power
      value_template: "{{ value_json.net_power_delivered | float | round(3) }}"
      device_class: power
      state_class: measurement
      unit_of_measurement: kW
